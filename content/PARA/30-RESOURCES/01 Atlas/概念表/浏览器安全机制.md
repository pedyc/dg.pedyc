---
title: 浏览器安全机制
aliases: [Browser Security, 沙箱机制]
tags: [领域/浏览器, 领域/安全, 核心概念, 面试/高频]
date-created: 2025-12-17
date-modified: 2025-12-25
status: 🟢 活跃
related:
  - [[同源策略]]
  - [[CSP]]
  - [[CORS]]
  - [[XSS]]
  - [[CSRF]]
---

## 🛡️ 核心概念：浏览器安全机制

### 🔎 核心定义

> [!abstract] 不可信环境下的信任锚点
> 浏览器是 Web 的操作系统，它运行在**不可信**的环境中（加载任意网站的代码）。
> 浏览器安全机制的核心在于**沙箱 (Sandbox)** 和 **隔离 (Isolation)**：默认假设所有代码都是恶意的，通过策略限制其对系统资源、用户数据和其他网站的访问权限。

---

### 🏗️ 防御体系架构 (The Defense Layers)

浏览器的安全机制不是单一的，而是分层的防御网：

```mermaid
graph TD
    %% --- 节点定义 ---
    %% 使用 <br> 进行换行，不要使用 Markdown 列表符号
    
    %% 传输层节点
    HTTPS["🔒 TLS/SSL 加密"]
    HSTS["🚀 HSTS 强制 HTTPS"]
    
    %% 核心隔离节点
    SOP["🧱 同源策略 (SOP)<br>DOM/数据/网络隔离"]
    Process["📦 进程隔离 (Site Isolation)<br>Tab 间内存独立"]
    
    %% 策略管控节点
    CSP["📝 CSP 内容安全策略<br>限制资源加载"]
    CORS["🤝 CORS 跨域资源共享<br>受控的开门"]
    
    %% 存储保护节点
    Cookie["🍪 Cookie 属性<br>HttpOnly / Secure / SameSite"]

    %% --- 子图分组 (Subgraphs) ---
    subgraph Net ["2. 传输：加密 (Transport)"]
        HTTPS
        HSTS
    end

    subgraph Core ["1. 基石：隔离 (Isolation)"]
        SOP
        Process
    end

    subgraph Policy ["3. 治理：管控 (Policy)"]
        CSP
        CORS
    end

    subgraph Storage ["4. 存储：保护 (Storage)"]
        Cookie
    end

    %% --- 连接关系 ---
    Net --> Core
    Core --> Policy
    Policy --> Storage

    %% --- 样式调整 (可选) ---
    %% 让子图标题更明显
    style Net fill:#f9f9f9,stroke:#333,stroke-width:1px
    style Core fill:#f9f9f9,stroke:#333,stroke-width:1px
    style Policy fill:#f9f9f9,stroke:#333,stroke-width:1px
    style Storage fill:#f9f9f9,stroke:#333,stroke-width:1px
````

---

### 🔑 关键机制详解 (Key Mechanisms)

#### 1. 隔离之墙：[[同源策略]] (SOP)

_这是浏览器安全的**根本**。_

- **定义**：限制来自不同源（协议 + 域名 + 端口）的文档或脚本，对当前文档读取或设置某些属性。
- **作用**：防止 `evil.com` 的 JS 读取你 `bank.com` 的 Cookie 或 DOM。
- **面试考点**：SOP 限制了什么？（Cookie/LocalStorage 读取、DOM 操作、AJAX 响应读取）。

#### 2. 受控开门：[[CORS]]

_SOP 的官方 " 后门 "。_

- **定义**：服务器通过 HTTP 响应头（如 `Access-Control-Allow-Origin`）告诉浏览器：" 我允许这个域名的请求 "。
- **注意**：CORS 是**浏览器**的行为，请求通常已经发送并被服务器处理了，只是浏览器拦截了**响应结果**。

#### 3. 内容管控：[[CSP]]

_XSS 的克星。_

- **定义**：白名单制度。开发者明确告诉浏览器，哪些外部脚本、图片、样式是允许加载的。
- **核心头**：`Content-Security-Policy: default-src 'self'; script-src 'self' https://trusted.com`

#### 4. 界面保护：防点击劫持

- **X-Frame-Options** / **CSP (frame-ancestors)**：禁止或限制当前页面被嵌入 `<iframe>`，防止 [[Clickjacking]]。

---

### ⚔️ 攻防映射矩阵 (Threat Matrix)

作为前端工程师，你需要知道每个机制具体是为了防御什么：

|**攻击类型**|**核心防御机制 (Primary Defense)**|**辅助手段 (Secondary)**|
|---|---|---|
|**[[XSS]]** (脚本注入)|**[[CSP]]** (限制执行)|**HttpOnly** (防窃取 Cookie)、转义输出|
|**[[CSRF]]** (伪造请求)|**SameSite Cookie**|**CSRF Token**、验证 Referer|
|**[[Clickjacking]]** (点击劫持)|**X-Frame-Options**|**CSP (frame-ancestors)**|
|**MITM** (中间人攻击)|**[[HTTPS]]** / **[[HSTS]]**|-|
|**跨站数据窃取**|**[[同源策略]]**|**CORB** (跨域读取阻塞)|

---

### 📥 待办与思考 (Inbox)

- [ ] **面试题**：浏览器也是多进程的（Chrome 架构），这对安全有什么好处？（答案：一个 Tab 崩了/中毒了，不会影响其他 Tab —— Site Isolation）。
- [ ] **实战**：检查当前项目的 `index.html` 或 Nginx 配置，是否开启了 HSTS 和 CSP？
- [ ] **进阶**：了解 Chrome 的 **CORB (Cross-Origin Read Blocking)** 机制是如何在底层配合 SOP 的。

### 📚 参考资料

- [[MDN Web Security]]
- Google Developers: [Site Isolation](https://developer.chrome.com/blog/site-isolation/)
